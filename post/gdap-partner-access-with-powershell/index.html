<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        GDAP Partner Access With M365 PowerShell Modules ::
        David Just — A simple theme for Hugo
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="GDAP Partner Access With M365 PowerShell Modules We can utilize our partner delegated access to authenticate to clients directly without the need to use an admin account. We can authenticate as ourselves with delegated access.
Pre-requisites It is highly recommended to use PowerShell 7&#43; when using any of the following PowerShell modules. Microsoft has ceased all development on Windows PowerShell (5.1 the “blue” window). All current and future focus is on the cross-platform PowerShell core."
/>
<meta
  name="keywords"
  content=""
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="/post/gdap-partner-access-with-powershell/" />




<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'Page(\/post\/GDAP-Partner-Access-With-PowerShell\/index.md)', 'auto');
ga('send', 'pageview');

</script>




<link rel="stylesheet" href="/assets/style.css" />


<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="/img/favicon.png" />


<link href="/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="GDAP Partner Access With M365 PowerShell Modules"/>
<meta name="twitter:description" content="GDAP Partner Access With M365 PowerShell Modules We can utilize our partner delegated access to authenticate to clients directly without the need to use an admin account. We can authenticate as ourselves with delegated access.
Pre-requisites It is highly recommended to use PowerShell 7&#43; when using any of the following PowerShell modules. Microsoft has ceased all development on Windows PowerShell (5.1 the “blue” window). All current and future focus is on the cross-platform PowerShell core."/>



<meta property="og:title" content="GDAP Partner Access With M365 PowerShell Modules" />
<meta property="og:description" content="GDAP Partner Access With M365 PowerShell Modules We can utilize our partner delegated access to authenticate to clients directly without the need to use an admin account. We can authenticate as ourselves with delegated access.
Pre-requisites It is highly recommended to use PowerShell 7&#43; when using any of the following PowerShell modules. Microsoft has ceased all development on Windows PowerShell (5.1 the “blue” window). All current and future focus is on the cross-platform PowerShell core." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/gdap-partner-access-with-powershell/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2024-06-17T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-06-17T00:00:00+00:00" />







  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark">PS C:\Users\Dave></span>
    <span class="logo__text">DavidJust</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
            
          <li><a href="/about">About <img src=""/> 
          </a></li>        
          
        
      
            
          <li><a href="https://github.com/djust270">Github <img src=""/> 
          </a></li>        
          
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="https://github.com/djust270">Github</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">GDAP Partner Access With M365 PowerShell Modules</h1>
    <div class="post-meta">
      
        <span class="post-date">      
          June 17, 2024
        </span>

        
          
        
      

      


      
    </div>

    

    

    <div class="post-content">
      
      <h2 id="gdap-partner-access-with-m365-powershell-modules">GDAP Partner Access With M365 PowerShell Modules <a href="#gdap-partner-access-with-m365-powershell-modules">
  <svg height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg" fill= #01F9C6>
  <path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
  
</svg>
</a></h2><p>We can utilize our partner delegated access to authenticate to clients directly without the need to use an admin account. We can authenticate as ourselves with delegated access.</p>
<h3 id="pre-requisites">Pre-requisites <a href="#pre-requisites">
  <svg height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg" fill= #01F9C6>
  <path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
  
</svg>
</a></h3><p>It is highly recommended to use PowerShell 7+ when using any of the following PowerShell modules. Microsoft has ceased all development on Windows PowerShell (5.1 the “blue” window). All current and future focus is on the cross-platform PowerShell core. While modules may currently and continue to work with Windows PowerShell, the best experience will be had when using the latest version of PowerShell.</p>
<p>To install PowerShell 7+, search the Microsoft store for PowerShell.</p>
<p>You will need the exchange organization name and tenantID of the client tenant to authenticate with delegated access. This can be easily found in the Partner Center customer list <a href="https://partner.microsoft.com" target="_blank">
    Partner Center (microsoft.com)
  </a>.</p>
<h3 id="exchange-online">Exchange Online <a href="#exchange-online">
  <svg height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg" fill= #01F9C6>
  <path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
  
</svg>
</a></h3><p>To connect to Exchange Online PowerShell with delegated access:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Connect-ExchangeOnline -DelegatedOrganization domain.onmicrosoft.com 
</span></span></code></pre></div><p>You will be directed to authenticate inside a web browser. Log in with your o365 credentials.</p>
<h3 id="purview">Purview <a href="#purview">
  <svg height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg" fill= #01F9C6>
  <path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
  
</svg>
</a></h3><p>Similar to exchange online, we can connect using the DelegatedOrganization parameter, but we must also specify the authorization endpoint:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$TenantID = <span style="color:#960050;background-color:#1e0010">‘</span>dac510b8-85bc-43f6-85d4-dc29d0b1bdd7<span style="color:#960050;background-color:#1e0010">’</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Connect-IPPSSession -DelegatedOrganization domain.onmicrosoft.com -AzureADAuthorizationEndpointUri https<span style="color:#960050;background-color:#1e0010">:</span>//login.microsoftonline.com/dac510b8-85bc-43f6-85d4-dc29d0b1bdd7/oauth2/authorize 
</span></span></code></pre></div><h3 id="microsoft-teams">Microsoft Teams <a href="#microsoft-teams">
  <svg height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg" fill= #01F9C6>
  <path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
  
</svg>
</a></h3><p>To connect to Microsoft Teams, specify the TenantID of the client tenant as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Connect-MicrosoftTeams -TenantID dac510b8-85bc-43f6-85d4-dc29d0b1bdd7 
</span></span></code></pre></div><h3 id="microsoft-graph">Microsoft Graph <a href="#microsoft-graph">
  <svg height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg" fill= #01F9C6>
  <path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
  
</svg>
</a></h3><h2 id="microsoft-graph-module-with-pre-authorization">Microsoft Graph Module with Pre-Authorization <a href="#microsoft-graph-module-with-pre-authorization">
  <svg height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg" fill= #01F9C6>
  <path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
  
</svg>
</a></h2><p>The Microsoft Graph module uses a EntraID Enterprise Application for sign-in authorization. This application must be added and authorized in the tenant by a global admin before it can be used by a partner account.</p>
<p>Just like the Teams module, specify the tenant ID with Connect-MGGraph</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Connect-MGGraph -TenantID dac510b8-85bc-43f6-85d4-dc29d0b1bdd7 
</span></span></code></pre></div><h2 id="microsoft-graph-module-without-pre-authorization">Microsoft Graph Module without Pre-Authorization <a href="#microsoft-graph-module-without-pre-authorization">
  <svg height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg" fill= #01F9C6>
  <path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
  
</svg>
</a></h2><p>To connect using the Microsoft Graph PowerShell module, we first need to get a Graph access token. We can leverage the Az module to do this. This will only give limited read permissions.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Connect as yourself with Connect-AzAccount </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Connect-AzAccount 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Get a Graph access token for the client tenant </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$GraphToken = Get-AzAccessToken -TenantId dac510b8-85bc-43f6-85d4-dc29d0b1bdd7 -ResourceUrl https<span style="color:#960050;background-color:#1e0010">:</span>//graph.microsoft.com 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Connect to graph with the access token </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Connect-MGGraph -AccessToken ($GraphToken.Token | ConvertTo-SecureString -AsPlainText -Force) 
</span></span></code></pre></div><p>Alternatively, you can log into the EntraID portal or Intune Admin portal through the partner center link. Use the browser developer tools to capture and view HTTP calls to graph.microsoft.com</p>
<p>Copy the authorization token from the request header and use this with either the Invoke-RestMethod cmdlet, or with the Connect-MGGraph cmdlet in the Microsoft.Graph.Authentication module.</p>
<p>This will give you the same level of permissions as you have in the web admin portal.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$SecureToken = <span style="color:#e6db74">&#39;Bearer &#39;</span> + {JSON Web Token Copied from the browser} | ConvertTo-SecureString -AsPlainText -Force 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Connect-MGGraph -AccessToken $SecureToken 
</span></span></code></pre></div><h3 id="azuread">AzureAD <a href="#azuread">
  <svg height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg" fill= #01F9C6>
  <path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
  
</svg>
</a></h3><p>To connect using the AzureAD module, simply provide the client tenantID</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Connect-AzureAD -TenantID dac510b8-85bc-43f6-85d4-dc29d0b1bdd7 
</span></span></code></pre></div><h3 id="sharepoint-online">SharePoint Online <a href="#sharepoint-online">
  <svg height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg" fill= #01F9C6>
  <path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
  
</svg>
</a></h3><p>With the Microsoft.Online.SharePoint.PowerShell we can connect by specifying the Admin URL and the authentication URL with the client tenantID as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># If using PowerShell 7, import the module with backwards compatibility </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Import-Module Microsoft.Online.SharePoint.PowerShell -UseWindowsPowerShell 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$TenantID = <span style="color:#960050;background-color:#1e0010">‘</span>dac510b8-85bc-43f6-85d4-dc29d0b1bdd7<span style="color:#960050;background-color:#1e0010">’</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Connect-SPOService -Url https<span style="color:#960050;background-color:#1e0010">:</span>//domain-admin.sharepoint.com -AuthenticationUrl https<span style="color:#960050;background-color:#1e0010">:</span>//login.microsoftonline.com/$TenantID/oauth2/authorize 
</span></span></code></pre></div><h3 id="conclusion">Conclusion <a href="#conclusion">
  <svg height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg" fill= #01F9C6>
  <path d="M0 0h24v24H0z" fill="none"></path><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
  
</svg>
</a></h3><p>By leveraging partner delegated access with the appropriate PowerShell modules, we can efficiently manage client tenants without needing admin accounts.</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="/post/export-all-bitlocker-keys-from-entraid/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Export all Bitlocker Keys from Entra ID</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="/post/the-new-microsoft-store-experience-in-intune/">
                  <span class="button__text">The New Microsoft Store Experience in Intune</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        



      
    
  </div>
  


      </div>

      
        <footer class="footer">
  davidjust.com © 2024     
  <div class="footer__inner">    
  </div>
  <div class="footer__right">     
     
  </div>     
</footer>
<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
